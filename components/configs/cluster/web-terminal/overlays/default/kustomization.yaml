apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

patches:
  - target:
      group: workspace.devfile.io
      kind: DevWorkspaceTemplate
    patch: |-
      - op: replace
        path: /spec/components/0/container/args
        value:
          - "/bin/bash"
          - "-c"
          - |
            #!/bin/bash
            GIT_REPO=https://github.com/codekow/demo-ai-gitops-catalog.git

            git clone "${GIT_REPO}" gitops

            cd gitops
            . scripts/functions.sh

            check_bin busybox
            check_bin rclone
            check_bin restic

            echo "echo 'This terminal has been enhanced.'" >> ~/.bashrc
            echo "echo See ${GIT_REPO}" >> ~/.bashrc
            echo "cd gitops; . scripts/functions.sh; cd .." >> ~/.bashrc

            sleep infinity
